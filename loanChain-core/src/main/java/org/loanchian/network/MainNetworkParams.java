package org.loanchian.network;

import org.loanchian.Configure;
import org.loanchian.crypto.Sha256Hash;
import org.loanchian.message.DefaultMessageSerializer;
import org.loanchian.message.MessageSerializer;
import org.loanchian.store.BlockStore;
import org.loanchian.utils.Hex;
import org.loanchian.utils.Utils;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.InetSocketAddress;

/**
 * 主网各参数
 * @author ln
 *
 */
public class MainNetworkParams extends NetworkParams {

	private static MainNetworkParams instance;

	public static synchronized MainNetworkParams get() {
		if (instance == null) {
			instance = new MainNetworkParams();
		}
		return instance;
	}

	public MainNetworkParams() {

		this.seedManager = new RemoteSeedManager();

		seedManager.add(new Seed(new InetSocketAddress("192.168.1.5", Configure.PORT)));
		seedManager.add(new Seed(new InetSocketAddress("192.168.1.6", Configure.PORT)));
//		seedManager.add(new Seed(new InetSocketAddress("101.132.33.140", Configure.PORT)));
//		seedManager.add(new Seed(new InetSocketAddress("116.62.135.185", Configure.PORT)));
//		seedManager.add(new Seed(new InetSocketAddress("116.62.117.200", Configure.PORT)));
//		seedManager.add(new Seed(new InetSocketAddress("47.92.4.19", Configure.PORT)));
//		seedManager.add(new Seed(new InetSocketAddress("47.92.26.16", Configure.PORT)));

		init();
	}

	public MainNetworkParams(SeedManager seedManager, int port) {
		this.seedManager = seedManager;
		this.port = port;

		init();
	}

	private void init() {
		this.packetMagic = 86061588l;
		this.acceptableAddressCodes = new int[] {getSystemAccountVersion(), getCertAccountVersion()};
	}

	@Override
	public int getProtocolVersionNum(ProtocolVersion version) {
		return version.getVersion();
	}

	@Override
	public MessageSerializer getSerializer(boolean parseRetain) {
		return new DefaultMessageSerializer(this);
	}

	/**
	 * 创建创世快
	 * @return BlockStore
	 */
	@Override
	public BlockStore getGengsisBlock() {

		BlockStore gengsisBlock = new BlockStore(this, Hex.decode("0000000000000000000000000000000000000000000000000000000000000000000000008c5bab5ff30e63e4133864e1f1c5fcffea009d762a29a081e665a0ed08d52c9eac709e59000000000000ac709e59822103c88c3fd9ad654a3cb89bdc62b1811e0570d36ef229a8e2f3df6e25a03a02e09376a91429af9e39008fa61b5dbaeb7151f05bae0e99fbd9884630440220640e2390967a750e6e6590e698ed9b3aec806e0e0a9086bcea348a8ee858c83202206db0ce5969c56f93c7c947bcca99abca9e8b1ed83b339137a8fd8ef2d3d3578cac180101000000010012117468697320612067656e6773697320747800000000010080faca73f91f00000000001976a91458beed5007c23824d6949b2351ac5bf378873dd388acac709e59000000000002010000000101ad1d70ac0c0fd10b059fe15361c2dd33c2adc2949a8933faca4de499592062a4000000006a47304402206a32d626a0bd4211d817b5bdc8f6ed82e1c43754df73c225e916a1c86f02c01c02204564aadec326d65f7310ba8e181170fcd8f7c8d1a08178dc01c68d64d70d7142012103b2d7fe3b88a996f89d08e0fd74eff21f381f25d45fd27b80c065e0acb509a79fffffffff020080c6a47e8d0300005f615d1976a91462bb8758c20c681c289f446f3600867d6de368df88ac00003426f56b1c00000000001976a91458beed5007c23824d6949b2351ac5bf378873dd388acac709e5900000000000601000000ac709e59832103c88c3fd9ad654a3cb89bdc62b1811e0570d36ef229a8e2f3df6e25a03a02e09376a91429af9e39008fa61b5dbaeb7151f05bae0e99fbd988473045022100c5d3fe87a02dff29bcd64dfa2a834c05007b8523c82eec8d8449f84d565c4a9a02205e5d60122ec35c8e75b477af537411ea1aa737a3995c45974126a176107ae381ac29af9e39008fa61b5dbaeb7151f05bae0e99fbd901000000000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101e9933d68953360d141c621205d30fce7838ff9d9dff03c012d1f92bbef0ea515010000006b483045022100ca2ca3d336b4b5e850ac1c8960df16885617c48f2ea5259c79775d4379bd451c022035a1550425cbceebe90f10f27305d347405164cfd6ae15c6a61633980b130c2d012103b2d7fe3b88a996f89d08e0fd74eff21f381f25d45fd27b80c065e0acb509a79fffffffff020010a5d4e8000000000000001976a91429af9e39008fa61b5dbaeb7151f05bae0e99fbd988ac00f08e510c6b1c00000000001976a91458beed5007c23824d6949b2351ac5bf378873dd388acac709e59000000000003010000000000ac709e590000000000822103c88c3fd9ad654a3cb89bdc62b1811e0570d36ef229a8e2f3df6e25a03a02e09376a91429af9e39008fa61b5dbaeb7151f05bae0e99fbd98846304402201991428ca171ae2b0de7e337024c67b1014b0745a6f729b4ded592e5da66b9ac022079c2e196965807877d8f5fc6772611f940909462cd6fc1d8e2e42221db3978d6ac6a24e81229af9e39008fa61b5dbaeb7151f05bae0e99fbd90601000000ac709e598321026be5bb5402d73e1d12fe750063ac8b1568774d3aa1f2465f386e5b63706773ca76a914467f3335249aeb74f3d219b4fb9d5da27287707f88473045022100cfc20dc5462492d1812a5805e11415d95f65c11115544290d231a28bffecbfd502201e1c34a39fb4f1c90df9b9b1900cca4e2a5b75577a997c4c58e85248185c2bdfac467f3335249aeb74f3d219b4fb9d5da27287707f010000000000000000000000000000000000000000000000000000000000000000000000000000000000020100000001015fd5d34cbf2817588f164cc6a04f92ad066ecd4d9eea82b6a29382dc8b0bb5a2010000006a473044022061f47b262c784435a83af153b0cf361bdf8771d486c324ebb3dacc7fee217a860220663d1292ed3384fb22facd84a62d86d63eb52f000e6ff2f44d785607334a15ec012103b2d7fe3b88a996f89d08e0fd74eff21f381f25d45fd27b80c065e0acb509a79fffffffff020010a5d4e8000000000000001976a914467f3335249aeb74f3d219b4fb9d5da27287707f88ac00e0e97c236a1c00000000001976a91458beed5007c23824d6949b2351ac5bf378873dd388acac709e59000000000003010000000000ac709e5900000000008221026be5bb5402d73e1d12fe750063ac8b1568774d3aa1f2465f386e5b63706773ca76a914467f3335249aeb74f3d219b4fb9d5da27287707f88463044022026bb421fcd5086bea0ab86ad25655935dfd3c5c7a043be7d1027da0b98ff5b37022006f08f4f2f0b3c3669a72b46a935728a1d81d7f81ed2fc30c32b8e2f1248b1daac6a24e812467f3335249aeb74f3d219b4fb9d5da27287707f0601000000ac709e5983210279a619a08b08bd823eabb0fe28e543550019e502932ca4fb41ae7da0cbd7cbcb76a91490c8a3ec255015e1e1a5ef33cf289e8d4d47d77388473045022100ec397ecae3828b7e4e9e0a8bc81bc8e771af7c85cc144aeb3df0e7adea2316510220701c101f6b090555c4a23c77f7fcc9d14642d3844f59151c3543306ba66d959dac90c8a3ec255015e1e1a5ef33cf289e8d4d47d773010000000000000000000000000000000000000000000000000000000000000000000000000000000000020100000001017108e03d3562b18de0e9fe7b65f98db7d680a1dfdae008217146995002a61e23010000006b483045022100b7a0fbb7fbed5a703fb73b3291e735f88eda5147a7223a653b3652573353588e02204d8c2f1192b72fd0fe00b62ac5353e187e179e5fadee9a29aba8cd92cf61b4e9012103b2d7fe3b88a996f89d08e0fd74eff21f381f25d45fd27b80c065e0acb509a79fffffffff020010a5d4e8000000000000001976a91490c8a3ec255015e1e1a5ef33cf289e8d4d47d77388ac00d044a83a691c00000000001976a91458beed5007c23824d6949b2351ac5bf378873dd388acac709e59000000000003010000000000ac709e59000000000083210279a619a08b08bd823eabb0fe28e543550019e502932ca4fb41ae7da0cbd7cbcb76a91490c8a3ec255015e1e1a5ef33cf289e8d4d47d77388473045022100859061e7fdf0f082c5683c3ac2d2dc04505de6c6f12f93d82268302fd03ea81702205c7445214fddad88c4ccd1ae09921d98fe8263ce4f14f3fcf08293d7a90ee263ac7a24e81290c8a3ec255015e1e1a5ef33cf289e8d4d47d7730601000000ac709e59822102fc25beaaf30e9f4384474009d4351e75eda3f693b9e59ba5c5de4f16da1233c676a914a7459c79f4dceb5e5105da1134775e2a026e7c2a8846304402204126cc6c5ee37c2c5564ea393c32e89b947778255e9148577a609ea298ecd8ff02200a734c0efd4e65187aad9aa0153ca9adc22cc42afc9b4a925b171cdfadbff620aca7459c79f4dceb5e5105da1134775e2a026e7c2a01000000000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101480fbb2a7c5984f15ad84f384245050469b0c64eb174cd6a4363d05e877ae456010000006a47304402203fdc6ac2b89068b2465e0a4fcfc43212e0317481522177ee256c0ccb673b8cb80220425b70fea6ad6ccbe4e688cc9c0c5d26a5a704c8803ae86beceb624b2558bf91012103b2d7fe3b88a996f89d08e0fd74eff21f381f25d45fd27b80c065e0acb509a79fffffffff020010a5d4e8000000000000001976a914a7459c79f4dceb5e5105da1134775e2a026e7c2a88ac00c09fd351681c00000000001976a91458beed5007c23824d6949b2351ac5bf378873dd388acac709e59000000000003010000000000ac709e590000000000822102fc25beaaf30e9f4384474009d4351e75eda3f693b9e59ba5c5de4f16da1233c676a914a7459c79f4dceb5e5105da1134775e2a026e7c2a884630440220728c3b9207d9d2d2445d3ccc6920df4187a6bf5362d2bf875198aebeefd3fcc1022003e03bf4078e48f4963b28aecbe40806b763bd98c62319dd37326b8d1289600aac7a24e812a7459c79f4dceb5e5105da1134775e2a026e7c2a0601000000ac709e59832103d28e6d213b629ea2a5f46da477c09bdc6f1dccf6fe541f820e907b24493438d276a914a4f7baf52a750f56572e092822959efa83e4763b88473045022100bd7beeff7488e88b9bad4eebb804f7e49d5f8fd882d07bc1fa25ed5df6e9c80102207c66a794d4fe8f116c1caf2c86f5a190a670d186ff1eca1b27fedf25cd3bb4a8aca4f7baf52a750f56572e092822959efa83e4763b01000000000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101121cfa6242bbb28b199485f86016485375dda416616b73451c48e74d8c0615be010000006946304302207daff06fd324679347c62c29d6f5a3185378e04ac32a32972c77ee1b772b5788021f7e90f5ba472849c3f75f265e6b7cd0fa7d927d91cee8b3b0e3550dd30d485c012103b2d7fe3b88a996f89d08e0fd74eff21f381f25d45fd27b80c065e0acb509a79fffffffff020010a5d4e8000000000000001976a914a4f7baf52a750f56572e092822959efa83e4763b88ac00b0fafe68671c00000000001976a91458beed5007c23824d6949b2351ac5bf378873dd388acac709e59000000000003010000000000ac709e590000000000822103d28e6d213b629ea2a5f46da477c09bdc6f1dccf6fe541f820e907b24493438d276a914a4f7baf52a750f56572e092822959efa83e4763b8846304402203ce3dd012314a012815789042154a6ba3b0de49b6ff6f0e5d8de330f1fa8917002205a98c7410377b879356ad16f357162801ea4e5dd74a9d344600589b259574ea5ac7a24e812a4f7baf52a750f56572e092822959efa83e4763b0601000000ac709e598221033e48a377c7830442daceb6fc686b458e2c8b14384989ab657d800e9dd078d42276a91438c6f139891719b79274a759419a3bb5fdd31bef8846304402206e3719a705ec274aaea768b03840dbc6079da28bd46316f3412ce4bb2b0276200220697a5cc90693d706596992202bc93d842712b970b69f957d912f557c60c5db21ac38c6f139891719b79274a759419a3bb5fdd31bef01000000000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101789cdb9889fdbde6ad5e68c1830b95fe23d2658049556f3dfd9f49eca1977fa5010000006a473044022041b214f6638a9ccb5ed241e3cb2ec219b3feba57c1e72eceeb06d73f30b966d302205e7875cabb02459e3adbbe0c3be3e3d27b15f06487613bb74ae5d02c9852ff2e012103b2d7fe3b88a996f89d08e0fd74eff21f381f25d45fd27b80c065e0acb509a79fffffffff020010a5d4e8000000000000001976a91438c6f139891719b79274a759419a3bb5fdd31bef88ac00a0552a80661c00000000001976a91458beed5007c23824d6949b2351ac5bf378873dd388acac709e59000000000003010000000000ac709e5900000000008321033e48a377c7830442daceb6fc686b458e2c8b14384989ab657d800e9dd078d42276a91438c6f139891719b79274a759419a3bb5fdd31bef88473045022100dc8a0cf781f39b01ff68ec0b274b0d42e0152bb5e80321554cf9619ec81e112102201eebbcc1189619fb6740eb83ffdc52107c0cc8d66500582ebd095240796af216ac8924e81238c6f139891719b79274a759419a3bb5fdd31bef0601000000ac709e59822102b4d5ad9bdbf6e75a2d840db09f7158eda4cbd9335a91400fb43ab2b6d67bfdf676a9147696561ec5a4224093cb05aed428a4d182ef169f88463044022076d1575a5d13c04a421030e75760477fb173f52ffd14dc8d5f6825734e880dc3022032b43835a693389a42d45a3a622c5dbcb3a3fe1ea07456b03f914e5dbaf0e314ac7696561ec5a4224093cb05aed428a4d182ef169f010000000000000000000000000000000000000000000000000000000000000000000000000000000000020100000001019d3c36856a496981271d2cf7b32432d48de92ac70d7faccda220d3bca6a9b9cb0100000069463043021f1f029d9f81d487ea3a19286564209550e05b73a4002fe85b08420e1459301902206967c8c0e6360273be94235f7520e94f3a64b3a6b97ef534c68275a6ca5247e8012103b2d7fe3b88a996f89d08e0fd74eff21f381f25d45fd27b80c065e0acb509a79fffffffff020010a5d4e8000000000000001976a9147696561ec5a4224093cb05aed428a4d182ef169f88ac0090b05597651c00000000001976a91458beed5007c23824d6949b2351ac5bf378873dd388acac709e59000000000003010000000000ac709e590000000000822102b4d5ad9bdbf6e75a2d840db09f7158eda4cbd9335a91400fb43ab2b6d67bfdf676a9147696561ec5a4224093cb05aed428a4d182ef169f884630440220381239628611764d25e45c656f78fd2968d1173dd6ec07ac6b2da5b6576eb4e80220609ef8c5eb3e76c3a026f74ab90f9b793d43e653ed1d284978276d1533507573ac8924e8127696561ec5a4224093cb05aed428a4d182ef169f0b010000003c709e5982c22067a1a5f748ba0e4364c2c654942512d03117372738e3687c3682c3afb82919bcc3148ad898b3870a508f6dd15eaf0ab817472d27556788473045022100e2b32b081b7a84dc763463b0ab8839e810b9f81393dcfdabbcbf971830c5d5cc022079e2d8b9cbfcfdd656c8c8bff281f984a68d7d2c2c372fd303bb21e67302cab1ac8ad898b3870a508f6dd15eaf0ab817472d2755678ad898b3870a508f6dd15eaf0ab817472d27556701fd33022e046e616d6506e5908de7a7b021496e636861696e20466f756e646174696f6ee58db0e993bee59fbae98791e4bc9a44046c6f676f06e59bbee7898737687474703a2f2f66696c652e696e636861696e2e6f72672f696d616765732f696e636861696e5f6c6f676f5f313030783130302e706e6727077765627369746506e5ae98e7bd911768747470733a2f2f7777772e696e636861696e2e6f72671f076164647265737309e6b3a8e5868ce59cb00ce4b8ade59bbde9a699e6b8af1e04646174650ce68890e7ab8be697a5e69c9f0b32303137e5b9b437e69c88fd550108646573637269707406e4bb8be7bb8dfd4201496e636861696e20466f756e646174696f6ee58db0e993bee59fbae98791e4bc9a28e4bba5e4b88be7ae80e7a7b0e2809ce59fbae98791e4bc9ae2809d29e698afe4ba8e32303137e5b9b437e69c88e59ca8e4b8ade59bbde9a699e6b8afe68890e7ab8be79a84e99d9ee79b88e588a9e680a7e68b85e4bf9de585ace58fb8efbc8ce59fbae98791e4bc9ae79a84e4b8bbe8a681e79baee6a087e698afe4bf9de8af81496e636861696ee58b9fe99b86e8b584e98791e79a84e9808fe6988ee5ae89e585a8e7aea1e79086e58f8ae59088e79086e4bdbfe794a8efbc8ce887b4e58a9be4ba8ee68ea8e58aa8496e636861696ee585ace69c89e993bee9a1b9e79baee79a84e58fafe68c81e7bbade58f91e5b195efbc8ce4bf83e8bf9b496e636861696ee7a4bee58cbae7949fe68081e79a84e5928ce8b090e7a8b3e5ae9ae380820221035aafeae84325434897723eb462d15f83f62dea079c98f43c96965594da2d71942103acb26a3c346ef0480040cd1099b49143bbf702fe01eb29d7afd85886fde6fdcc0121033b3db51e9c3291df8ddebeb3229e53442867d355eff02ed1372f764072c6fd1900"));
		Sha256Hash merkleHash = gengsisBlock.getBlock().buildMerkleHash();

		if(log.isDebugEnabled()) {
			log.debug("创世块的哈希 : {}", merkleHash);
		}

		Utils.checkState("8c5bab5ff30e63e4133864e1f1c5fcffea009d762a29a081e665a0ed08d52c9e".equals(Hex.encode(merkleHash.getBytes())), "the gengsis block merkle hash is error");

		if(log.isDebugEnabled()) {
			log.debug("创世块的哈希键KEY : {}", gengsisBlock.getBlock().getHash());
		}

		Utils.checkState("a16af1e0dcd8dca4ee197d2fd6e0a7961c19aea53fc341ee55c022f7e4c9c89d".equals(Hex.encode(gengsisBlock.getBlock().getHash().getBytes())), "the gengsis block hash is error");

		return gengsisBlock;
	}

	/**
	 * 获取该网络的认证管理账号的hash160
	 * @return byte[]
	 */
	@Override
	public byte[] getCommunityManagerHash160() {

		return Hex.decode("48d883f777d63b3db0b89a864363c0dc90a27a71");
	}

	/**
	 * 主网普通地址以o开头
	 * return
	 */
	@Override
	public int getSystemAccountVersion() {
		return 111;
	}

	/**
	 * 主网，认证地址以A开头
	 * return
	 */
	@Override
	public int getCertAccountVersion() {
		return 65;
	}

}
