package org.loanchian.network;

import org.loanchian.Configure;
import org.loanchian.crypto.Sha256Hash;
import org.loanchian.message.DefaultMessageSerializer;
import org.loanchian.message.MessageSerializer;
import org.loanchian.store.BlockStore;
import org.loanchian.utils.Hex;
import org.loanchian.utils.Utils;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.InetSocketAddress;

/**
 * 主网各参数
 * @author ln
 *
 */
public class MainNetworkParams extends NetworkParams {

	private static MainNetworkParams instance;

	public static synchronized MainNetworkParams get() {
		if (instance == null) {
			instance = new MainNetworkParams();
		}
		return instance;
	}

	public MainNetworkParams() {

		this.seedManager = new RemoteSeedManager();

		seedManager.add(new Seed(new InetSocketAddress("192.168.1.5", Configure.PORT)));
		seedManager.add(new Seed(new InetSocketAddress("192.168.1.6", Configure.PORT)));
//		seedManager.add(new Seed(new InetSocketAddress("101.132.33.140", Configure.PORT)));
//		seedManager.add(new Seed(new InetSocketAddress("116.62.135.185", Configure.PORT)));
//		seedManager.add(new Seed(new InetSocketAddress("116.62.117.200", Configure.PORT)));
//		seedManager.add(new Seed(new InetSocketAddress("47.92.4.19", Configure.PORT)));
//		seedManager.add(new Seed(new InetSocketAddress("47.92.26.16", Configure.PORT)));

		init();
	}

	public MainNetworkParams(SeedManager seedManager, int port) {
		this.seedManager = seedManager;
		this.port = port;

		init();
	}

	private void init() {
		this.packetMagic = 86061588l;
		this.acceptableAddressCodes = new int[] {getSystemAccountVersion(), getCertAccountVersion()};
	}

	@Override
	public int getProtocolVersionNum(ProtocolVersion version) {
		return version.getVersion();
	}

	@Override
	public MessageSerializer getSerializer(boolean parseRetain) {
		return new DefaultMessageSerializer(this);
	}

	/**
	 * 创建创世快
	 * @return BlockStore
	 */
	@Override
	public BlockStore getGengsisBlock() {

		BlockStore gengsisBlock = new BlockStore(this, Hex.decode("0000000000000000000000000000000000000000000000000000000000000000000000008c0d4992aabeec78bb06dc0fd0e1aaf5cb5d0dc44631da0ddb8ee3b7f323e2055f302a5a0000000000005f302a5a822102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f309884630440220702c183b58ac5f185291519a8f2cbfe0ea5aca19f92b9a57058ad0b63792691c022019959bd5e9ea7eb4dbba0c1bcd60fd1e7212268e650b0eefd3278a12c940b37eac140101000000010012117468697320612067656e6773697320747800000000010080faca73f91f00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac5f302a5a000000000002010000000101f64d2af17650245b20b0cf522bf3262afc531d767cbebcf643221d24725c20d2000000006b4830450221009187f707bdd5f59c288ee7f8cb433fd5b75d4e797850c737907d69a218a3caeb02200b0847960f61973df92588638920016555f70f08a618c82585e2720bd0e6c2c201210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020080c6a47e8d03000078c2481976a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988ac00003426f56b1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac5f302a5a000000000006010000005f302a5a832102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988473045022100e016e090557d66b757dc46184be7c004bc6130ff3d5eac61a3f5751362f9d4ec02200ec7a3c083906247d8195e81e4ba52f7f2a66fb2fafb9d95f715c81d2f8b98a9ac4237cccf6ff9a7674a8fc47c60278fdd23e9f309010000000000000000000000000000000000000000000000000000000000000000000000000000000000020100000001019b922b09044c741da5e72d9d5da6cf3415ce947d6df0b63b0be77faaab5a4a51010000006b48304502210092e2f5c009d0a6a52c562aadf33959589c3554b212da2206fceb7f18cd2891ef02207fc7ba757ff7f4da51ee4d21633cf8bd19f9ce22d149ffdb03afab9f6c9ace0301210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988ac00f08e510c6b1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac5f302a5a0000000000030100000000005f302a5a0000000000832102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f3098847304502210096c79fc406ca3dfd74683c3386566d455e540297c163ff9c66d5fe1e82a3acc802206f38125a6d4e1f34a859e093699ca1dfd53f1fbc36d252643d8533cb32e7b6dcace4f4cc344237cccf6ff9a7674a8fc47c60278fdd23e9f30906010000005f302a5a822103a7db4a854e3f2ae3a30aa759bfd39045f6a80c967b3fd81036acebc54b557ece76a9142c1179b1e05fb8652644f6c61a033d2843100912884630440220255f8e938e9be50416fa5145a6c40e79675ebe86d7482759f51e65bde8e5eaa902201b6ce7508ceb49f08606deb256aec5c9d385533a83592e8dc8c6dcdbc395a37dac2c1179b1e05fb8652644f6c61a033d28431009120100000000000000000000000000000000000000000000000000000000000000000000000000000000000201000000010139e505b8c2ca925bc832a5dc73580593c28536af2e0ffdf5f815e127ddf228c8010000006a47304402203649b092987fb696be92901d3784907aa27fced6a649332f6fa17a790b4e9abe022068f1acf63ac0cf21fb8561a40f2eb526d46d9f5f12bc6ef8f703b4e77d7a114001210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a9142c1179b1e05fb8652644f6c61a033d284310091288ac00e0e97c236a1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac5f302a5a0000000000030100000000005f302a5a0000000000822103a7db4a854e3f2ae3a30aa759bfd39045f6a80c967b3fd81036acebc54b557ece76a9142c1179b1e05fb8652644f6c61a033d28431009128846304402203db1959c9905d64cee051be97320a0f5580696992ecdb9392935a9df04156bfe02200a4099bcd75e13160657c602fa3063b2a9ab7bfc5429a4b493847d73fd6cd6dbaceaf4cc342c1179b1e05fb8652644f6c61a033d284310091206010000005f302a5a8321033e371b2f3d42dd525833bcce12cb0d404fb73898bdea3e6794bd8ec552c9ba9c76a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c884730450221008503e09e593138f5eb52342dddceeff9ce7990f0488e6a4d6de79a11493180c902201e66a1c4b0edfaa38d6084aabd5efd074270b974b65026d310b162e943ae0f97acb3fcd687a5c2b2617de0d504cfa7d12db93bb00c0100000000000000000000000000000000000000000000000000000000000000000000000000000000000201000000010190d65a78c9047dcbe552ae30ba7bd904cf23d1c9a3cd6165dc6672e5cabf0340010000006b483045022100dda599a7bff6c6a83f576495d41392e889878d11020587f4d6044ae831d5d4320220501953480c165bcd8c4cd9eccd506d41403ebfa1126ae6b5c5011d8f297c21da01210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c88ac00d044a83a691c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac5f302a5a0000000000030100000000005f302a5a00000000008221033e371b2f3d42dd525833bcce12cb0d404fb73898bdea3e6794bd8ec552c9ba9c76a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c8846304402203ac369376f2e85a9de366d0b7a1b836484bbdb37adfeb297e8a6c8d2d735a7d702204602c3c47fc92343d637644ca78b0ce3cb4da56afe9bb6f034448dc31d108bffacf0f4cc34b3fcd687a5c2b2617de0d504cfa7d12db93bb00c06010000005f302a5a822103bf7759e9b81f8ff1b99732b3ee36aea0abff68c818b8839c318ad350e9642cb076a914c3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a88846304402206c1a521ec49d8bf0a741a6796aa5c2095c57fd34c7d120d9432b93bbaa6e4cd9022038d397ff178c5de0ccea8c52ddbb79ab48d799d4a3b1cc42d427ff2b66f0fdc1acc3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a801000000000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101ba5c19ee729838d65ee049ebc47e704aa4619e70d3c05383b57e996660a49dc2010000006a473044022037cbb3268d017f219f2b9f75a301f9a16a5e200692bd01d94a0a0ec03f903c5102200be3465cdfee0fc19d19b10f66fd9368785d4669586c87df13e3e7e88e971a7501210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a914c3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a888ac00c09fd351681c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac5f302a5a000000000006010000005f302a5a82210200d482122f8537ad2fa1af1914e088d6b308824a8ef4dc8b68fa0e0a88c484e376a9145f1a078b610d92a3110b2c1a7f880b0d2442e5308846304402203f56a5bed790544b5099c127416bb4081e5a6d3d7c9187a7b8a0c7112527117b0220589007fec869e719decc7ef590307700d1440b86b337692b5f29081432b13736ac5f1a078b610d92a3110b2c1a7f880b0d2442e5300100000000000000000000000000000000000000000000000000000000000000000000000000000000000201000000010172ce5f1b27f7cd15c333fe3204c111e5dba7385eaafe71894b2e947188888a50010000006b483045022100820751db528025a5f778a2b876037c23d9630e5c9127f42e0e7cbb6377d2293902205242406c0b62e2dee67202c7d8c63c871556d581aa58a769d55249dbf935853f01210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a9145f1a078b610d92a3110b2c1a7f880b0d2442e53088ac00b0fafe68671c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac5f302a5a000000000006010000005f302a5a832103e8769d1901a4ef006054405c16716d6648fffe628385db5586c7fa18c3df5da876a914df639c6066a817a6be28b532839f8e1e85594cd488473045022100f74883916b0bd52b3bffbfea52174a6727ab22f401f7c73ed8f71c123c531016022018aacaa19da1146d84f074efccb3c0218b61335f18a4f706566ef5172ca02d0dacdf639c6066a817a6be28b532839f8e1e85594cd4010000000000000000000000000000000000000000000000000000000000000000000000000000000000020100000001016d10d52767a1cf619f6b8e82572a273336435b504307455c0c2373e4483a5a29010000006a4730440220302d0a30524ba0f54337d301e3b81dbd90050025f81e6c8a5484df9ebb4658e502202f5aa56e8576b4769f114026abbd7bc6efc17aebefa3103251bb3701b40d55a801210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a914df639c6066a817a6be28b532839f8e1e85594cd488ac00a0552a80661c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac5f302a5a000000000006010000005f302a5a822103368f8061e02694e37da199c07c3e2f2506cdd748efee493f0d1c52ae7494428f76a914e3453a80144f6ac24baf01f20455c6167b985485884630440220754acc9e0eaf11791e9c9a1ebf352d69f873e8055481f4abecf652b3b43cf723022040c95353eb68ee8995e363bc80785ee425960b10331c8b9bb56acc78428c6482ace3453a80144f6ac24baf01f20455c6167b98548501000000000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101a17efb2cc11a341178112bf456ed533bc91b53b55457b70daa58f60132b44963010000006a47304402202da66c12b26cbb9248320190dcf565e6678bd090182f7db0e7016efed7ad400702200cc3b554dcfc8a7148cf432ba227cf7ea99b4901c884c0cc740a20f7c56204be01210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a914e3453a80144f6ac24baf01f20455c6167b98548588ac0090b05597651c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac5f302a5a00000000000b0100000043da7e5982c220256303b7fa1e89761bf37c1a8415524dbcb9ec1b4033ce71d4224699e8459235c314dd1c14ee4f4642eb9c3e14cc97a3c3d3629708ea88473045022100c50a56f6bb25ea2ade3b83def48d7b55401916f711a634a8b2163b555343cef502203cda9a0c6735c72cf4599def1eaec90f32206e69ded301be46168aa2ad0286aaacdd1c14ee4f4642eb9c3e14cc97a3c3d3629708eadd1c14ee4f4642eb9c3e14cc97a3c3d3629708ea01fd23022b046e616d6506e5908de7a7b01ee9878de5ba86e58db0e993bee7a791e68a80e69c89e99990e585ace58fb822076164647265737306e59cb0e59d8012e9878de5ba86e5b882e58d97e5b2b8e58cba44046c6f676f06e59bbee7898737687474703a2f2f66696c652e696e636861696e2e6f72672f696d616765732f696e636861696e5f6c6f676f5f313030783130302e706e672b0a637265646974436f64650ce4bfa1e794a8e4bba3e7a0811239313530303130384d41355542333248334e1a0570686f6e6506e794b5e8af9d0c3032332d383633333130363927077765627369746506e5ae98e7bd911768747470733a2f2f7777772e696e636861696e2e6f7267fd1d0108646573637269707406e68f8fe8bfb0fd0a01e9878de5ba86e58db0e993bee7a791e68a80e69c89e99990e585ace58fb8e698afe4b880e5aeb6e4bba5e58cbae59d97e993bee68a80e69cafe9a9b1e58aa8e79a84e5889be696b0e59e8be4bc81e4b89aefbc8ce585b6e4b8bbe5afbce79a84e58cbae59d97e993bee7a4bee58cbae9a1b9e79bae496e636861696e2de58db0e993bee698afe4b880e4b8aae4bba5e998b2e4bcaae4b8bae59fbae7a180e4b89ae58aa1e79a84e585ace5bc80e5b9b3e58fb0efbc8ce4b8bae7a4bee4bc9ae59084e4bc81e4b89ae38081e69cbae69e84e38081e889bae69cafe5aeb6e7ad89e68f90e4be9be59381e7898ce38081e79fa5e8af86e4baa7e69d83e4bf9de68aa4e69c8de58aa1e380820221023cbfda1ae93a41187634206177a0482ee2c890540bd907a7f6fbdde9e5a31c3b2103489e3933f41327c2463b664776a4355860cf5b093c106d21f0253f83dda76465012103df243c24dfe4ea420c776e8d46fbc2a86c6e439648119f64b583a38a0c7d84fd00"));
		Sha256Hash merkleHash = gengsisBlock.getBlock().buildMerkleHash();

		if(log.isDebugEnabled()) {
			log.debug("创世块的哈希 : {}", merkleHash);
		}

		Utils.checkState("8c0d4992aabeec78bb06dc0fd0e1aaf5cb5d0dc44631da0ddb8ee3b7f323e205".equals(Hex.encode(merkleHash.getBytes())), "the gengsis block merkle hash is error");

		if(log.isDebugEnabled()) {
			log.debug("创世块的哈希键KEY : {}", gengsisBlock.getBlock().getHash());
		}

		Utils.checkState("349912dee6b7561f1b19dcab59dc7ce40227f7cd6175876e578789fd832e0b87".equals(Hex.encode(gengsisBlock.getBlock().getHash().getBytes())), "the gengsis block hash is error");

		return gengsisBlock;
	}

	/**
	 * 获取该网络的认证管理账号的hash160
	 * @return byte[]
	 */
	@Override
	public byte[] getCommunityManagerHash160() {

		return Hex.decode("48d883f777d63b3db0b89a864363c0dc90a27a71");
	}

	/**
	 * 主网普通地址以o开头
	 * return
	 */
	@Override
	public int getSystemAccountVersion() {
		return 111;
	}

	/**
	 * 主网，认证地址以A开头
	 * return
	 */
	@Override
	public int getCertAccountVersion() {
		return 65;
	}

}
